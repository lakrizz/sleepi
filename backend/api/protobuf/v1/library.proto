syntax = "proto3";

package sleepi.v1;

import "google/protobuf/timestamp.proto";
import "v1/common.proto";

enum FileType {
  FILE_TYPE_UNSPECIFIED = 0;
  FILE_TYPE_AUDIO = 1;
  FILE_TYPE_VIDEO = 2;
  FILE_TYPE_OTHER = 3;
}

message MediaFile {
  string id = 1;                       // uuid
  string title = 2;
  string artist = 3;                   // optional
  uint64 size_bytes = 4;
  string length_hms = 5;               // "MM:SS" or "HH:MM:SS"
  string mime_type = 6;                // e.g. "audio/mp3"
  FileType type = 7;
  google.protobuf.Timestamp uploaded_at = 8;
}

message ListFilesRequest {
  Page page = 1;
  string query = 2;        // optional search/filter term
}
message ListFilesResponse {
  repeated MediaFile files = 1;
  PageResult result = 2;
}

message UpdateFileMetaRequest {
  string id = 1;
  string title = 2;        // optional set
  string artist = 3;       // optional set
}
message UpdateFileMetaResponse { MediaFile file = 1; }

message DeleteFileRequest { string id = 1; }
message DeleteFileResponse {}

message UploadFileRequest {
  oneof data {
    FileMeta meta = 1;
    bytes chunk = 2;
  }
}
message FileMeta {
  string filename = 1;
  string mime_type = 2;
  uint64 size_bytes = 3;
}
message UploadFileResponse {
  MediaFile file = 1;
}

service LibraryService {
  rpc ListFiles (ListFilesRequest) returns (ListFilesResponse);
  rpc UpdateFileMeta (UpdateFileMetaRequest) returns (UpdateFileMetaResponse);
  rpc DeleteFile (DeleteFileRequest) returns (DeleteFileResponse);

  // Client-streaming upload: first message = meta, then chunks
  rpc UploadFile (stream UploadFileRequest) returns (UploadFileResponse);
}

